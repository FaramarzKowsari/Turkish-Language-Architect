<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Turkish Language Architect - Master Engineering Edition</title>
    <style>
        :root {
            --primary: #3b82f6;
            --bg: #0f172a;
            --sidebar-bg: #111827;
            --card-bg: #1e293b;
            --text-main: #f8fafc;
            --text-dim: #94a3b8;
            --accent-root: #fbbf24;
            --accent-person: #c084fc;
            --success: #22c55e;
            --error: #ef4444;
        }

        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background-color: var(--bg); 
            color: var(--text-main); 
            margin: 0; 
            display: flex; 
            min-height: 100vh; 
            overflow-x: hidden;
        }

        .rtl { direction: rtl; }
        .ltr { direction: ltr; }

        #sidebar { 
            width: 300px; 
            background-color: var(--sidebar-bg); 
            border-right: 1px solid #1f2937; 
            border-left: 1px solid #1f2937;
            display: flex; 
            flex-direction: column; 
            position: fixed; 
            height: 100vh; 
            z-index: 50; 
            overflow-y: auto;
        }

        .sidebar-header { padding: 25px 20px; text-align: center; border-bottom: 1px solid #1f2937; }
        .lang-select-box { padding: 15px 20px; border-bottom: 1px solid #1f2937; }
        select { 
            width: 100%; padding: 12px; border-radius: 8px; 
            background: #1e293b; color: white; border: 1px solid #334155; 
            outline: none; cursor: pointer; font-size: 13px;
        }

        .nav-category {
            padding: 15px 20px 5px;
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            color: var(--primary);
            font-weight: 900;
            background: rgba(59, 130, 246, 0.03);
        }

        .nav-item { 
            padding: 10px 24px; display: flex; align-items: center; 
            color: var(--text-dim); text-decoration: none; cursor: pointer; 
            font-size: 12.5px; transition: 0.3s; border-left: 4px solid transparent; border-right: 4px solid transparent;
        }
        .nav-item:hover { background: rgba(59, 130, 246, 0.05); color: var(--text-main); }
        .nav-item.active { background: rgba(59, 130, 246, 0.1); color: var(--primary); font-weight: bold; }

        main { flex-grow: 1; padding: 40px; display: flex; justify-content: center; transition: margin 0.3s ease; }

        .card { 
            background-color: var(--card-bg); border-radius: 24px; padding: 40px; 
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5); border: 1px solid #334155; 
            width: 100%; max-width: 900px; position: relative; 
        }

        .quiz-header { display: flex; justify-content: space-between; margin-bottom: 30px; color: var(--primary); font-weight: bold; font-size: 13px; }
        .v-root { font-size: 64px; font-weight: 900; color: var(--accent-root); display: block; text-align: center; cursor: pointer; }
        .v-mean { color: var(--text-dim); font-size: 18px; margin: 15px 0; display: block; font-style: italic; text-align: center; }
        .v-person { font-size: 24px; color: var(--accent-person); font-weight: bold; text-align: center; display: block; margin-bottom: 20px; }

        .input-area { margin: 30px 0; text-align: center; }
        input { 
            width: 90%; padding: 20px; border-radius: 18px; border: 3px solid #334155; 
            background: #0f172a; color: #fff; text-align: center; font-size: 32px; 
            outline: none; transition: 0.4s; font-family: monospace; 
        }
        input.correct { border-color: var(--success); background: rgba(34, 197, 94, 0.05); }
        input.wrong { border-color: var(--error); }

        .btn-group { display: flex; justify-content: center; gap: 10px; flex-wrap: wrap; margin-bottom: 20px; }
        .btn { padding: 15px 25px; border-radius: 14px; border: none; cursor: pointer; font-weight: bold; font-size: 13px; transition: 0.3s; }
        .btn-check { background: var(--primary); color: white; flex-grow: 1; max-width: 200px; }
        .btn-hint { background: #1e293b; color: #60a5fa; border: 1px solid #3b82f6; }
        .btn-reveal { background: #475569; color: white; }
        .btn-nav { background: #334155; color: white; width: 60px; font-size: 24px; display: flex; align-items: center; justify-content: center; }

        .expl-panel { 
            margin-top: 30px; padding: 25px; background: rgba(59, 130, 246, 0.05); 
            border-radius: 16px; display: none; line-height: 2; color: #cbd5e1; 
            text-align: justify; font-size: 15px; border-right: 4px solid var(--primary); border-left: 4px solid var(--primary);
            cursor: pointer;
        }

        .sample-usage-box { margin-top: 30px; padding: 25px; background: #111827; border-radius: 20px; border: 1px solid #334155; text-align: center; }
        .sample-tr { color: #38bdf8; font-size: 20px; font-weight: bold; cursor: pointer; display: block; margin-bottom: 12px; line-height: 1.6; }
        .sample-target { color: #94a3b8; font-size: 15px; display: block; text-align: justify; line-height: 1.8; border-top: 1px solid #334155; padding-top: 15px; }

        .author-photo-container { width: 150px; height: 150px; margin: 0 auto 20px; position: relative; }
        .author-photo { width: 100%; height: 100%; border-radius: 50%; border: 5px solid var(--primary); object-fit: cover; display: block; box-shadow: 0 10px 25px rgba(0,0,0,0.4); background-color: #334155; }
        .author-fallback { width: 100%; height: 100%; border-radius: 50%; background: var(--primary); display: flex; align-items: center; justify-content: center; font-size: 48px; font-weight: bold; color: white; border: 5px solid #334155; }

        @media (max-width: 992px) { #sidebar { width: 100%; height: auto; position: relative; border: none; } main { padding: 20px; margin: 0 !important; } }
    </style>
</head>
<body class="ltr">
    <aside id="sidebar">
        <div class="sidebar-header">
            <h2 id="ui-title" style="color:var(--primary); margin:0">Language Architect</h2>
            <p style="font-size:10px; color:var(--text-dim); margin-top:5px;">Faramarz Kowsari Lab</p>
        </div>
        
        <div class="lang-select-box">
            <select id="lang-selector" onchange="changeSourceLang(this.value)">
                <option value="en">üá∫üá∏ English</option>
                <option value="fa">üáÆüá∑ Persian (ŸÅÿßÿ±ÿ≥€å)</option>
                <option value="es">üá™üá∏ Spanish (Espa√±ol)</option>
                <option value="de">üá©üá™ German (Deutsch)</option>
                <option value="fr">üá´üá∑ French (Fran√ßais)</option>
                <option value="el">üá¨üá∑ Greek (ŒïŒªŒªŒ∑ŒΩŒπŒ∫Œ¨)</option>
                <option value="zh">üá®üá≥ Chinese (‰∏≠Êñá)</option>
                <option value="ar">üá∏üá¶ Arabic (ÿßŸÑÿπÿ±ÿ®Ÿäÿ©)</option>
            </select>
        </div>

        <nav class="nav-group" id="module-nav">
            <div class="nav-category" id="cat-tense">Tense</div>
            <div class="nav-item active" onclick="switchModule('past')" id="nav-past">Simple Past</div>
            <div class="nav-item" onclick="switchModule('present')" id="nav-present">Present Tense</div>
            <div class="nav-item" onclick="switchModule('future')" id="nav-future">Future Tense</div>

            <div class="nav-category" id="cat-aspect">Aspect</div>
            <div class="nav-item" onclick="switchModule('continuous')" id="nav-cont">Continuous (-yor)</div>
            <div class="nav-item" onclick="switchModule('aorist')" id="nav-aor">Aorist</div>
            <div class="nav-item" onclick="switchModule('perfect')" id="nav-perf">Perfect (-mi≈ü)</div>

            <div class="nav-category" id="cat-mood">Mood</div>
            <div class="nav-item" onclick="switchModule('imperative')" id="nav-imp">Imperative</div>
            <div class="nav-item" onclick="switchModule('conditional')" id="nav-cond">Conditional</div>
            <div class="nav-item" onclick="switchModule('obligative')" id="nav-obl">Obligative</div>
            <div class="nav-item" onclick="switchModule('ability')" id="nav-abil">Ability</div>

            <div style="border-top: 1px solid #1f2937; margin: 10px 0;"></div>
            <div class="nav-item" onclick="fkTab('list')" id="nav-list">Master Database</div>
            <div class="nav-category" id="cat-help">Academy</div>
            <div class="nav-item" onclick="fkTab('academy')" id="nav-academy">üèõÔ∏è Academy (Help)</div>
            <div class="nav-item" onclick="fkTab('auth')" id="nav-auth">The Architect</div>
        </nav>
    </aside>

    <main id="main-area">
        <div class="card" id="sec-quiz" style="display:block">
            <div class="quiz-header">
                <span id="module-title-ui">Module</span>
                <span id="fk-info">Step 1</span>
                <span id="fk-score">Score: 0</span>
            </div>
            <div class="display-box">
                <span class="v-root" id="v-root" title="Click for Turkish Audio">GEL</span>
                <span class="v-mean" id="v-mean">...</span>
                <span class="v-person" id="v-pers">...</span>
            </div>
            <div class="input-area">
                <input type="text" id="fk-input" autocomplete="off" spellcheck="false" placeholder="...">
            </div>
            <div class="btn-group">
                <button class="btn btn-nav" onclick="move(-1)">‚ùÆ</button>
                <button class="btn btn-check" id="ui-btn-check" onclick="check()">Check</button>
                <button class="btn btn-hint" id="ui-btn-hint" onclick="toggleHint()">Grammar Explanation</button>
                <button class="btn btn-reveal" id="ui-btn-reveal" onclick="reveal()">Show Answer</button>
                <button class="btn btn-nav" onclick="move(1)">‚ùØ</button>
            </div>
            
            <div id="v-expl" class="expl-panel" title="Click for Audio Analysis (Non-Farsi/Arabic)"></div>

            <div id="sample-box" class="sample-usage-box">
                <span id="ui-sample-tag" style="font-size: 10px; color: #475569; display: block; margin-bottom: 10px;">PRACTICAL USAGE:</span>
                <span class="sample-tr" id="sample-tr" title="Play Turkish Audio">...</span>
                <div id="sample-target" class="sample-target">...</div>
            </div>
        </div>

        <div class="card" id="sec-academy" style="display:none"><div class="academy-content" id="academy-body"></div></div>
        
        <div class="card" id="sec-list" style="display:none">
            <h2 id="list-title-ui" style="color:var(--primary)">Linguistic Database</h2>
            <div class="table-scroll"><table><thead><tr><th>#</th><th id="th-root">Root</th><th id="th-mean">Meaning</th><th id="th-ans">Answer</th><th>Audio</th></tr></thead><tbody id="list-body"></tbody></table></div>
        </div>

        <div class="card" id="sec-auth" style="display:none; text-align:center">
            <div class="author-photo-container">
                <img id="author-img" src="https://media.licdn.com/dms/image/v2/D4D03AQGBE3mihPZMzw/profile-displayphoto-shrink_200_200/profile-displayphoto-shrink_200_200/0/1705066609093?e=1772064000&v=beta&t=OBpBbgDTZSgHBg_E_UQaWRyS-jwCaC5tK9ry36PvOiQ" 
                     class="author-photo" 
                     alt="Faramarz Kowsari" 
                     onerror="this.style.display='none'; document.getElementById('author-fallback').style.display='flex';">
                <div id="author-fallback" class="author-fallback" style="display:none;">FK</div>
            </div>
            <h2 id="ui-author-name">Faramarz Kowsari</h2>
            <p id="ui-author-desc">PhD Researcher in AI & Language Architect</p>
            <div class="auth-btn-group">
                <a href="https://linkedin.com/in/faramarzkowsari" target="_blank" class="btn-social btn-linkedin" style="background:#0077b5; color:white; padding:10px 20px; border-radius:8px; text-decoration:none;">LinkedIn Profile</a>
                <a href="https://play.google.com/store/search?q=Faramarz_Kowsari&c=books" target="_blank" class="btn-social btn-googleplay" style="background:var(--primary); color:white; padding:10px 20px; border-radius:8px; text-decoration:none; margin-left:10px;">Google Play Books</a>
            </div>
        </div>
    </main>

    <script>
    (function(){
        let currentModule = 'past'; let sourceLang = 'en'; let cur = 0; let score = 0; let items = [];

        const i18n = {
            en: {
                title: "Language Architect", check: "Check Accuracy", hint: "Grammar Explanation", reveal: "Show Answer",
                past: "Simple Past", present: "Present Tense", future: "Future Tense", continuous: "Continuous (-yor)", aorist: "Aorist", perfect: "Perfect (-mi≈ü)",
                imperative: "Imperative", conditional: "Conditional", obligative: "Obligative", ability: "Ability",
                catTense: "Tense", catAspect: "Aspect", catMood: "Mood", catHelp: "Academy",
                personNames: {Ben:"I", Sen:"You", O:"He/She", Biz:"We", Siz:"You (pl)", Onlar:"They"}, academy: "üèõÔ∏è Academy", sampleTag: "PRACTICAL USAGE:",
                thRoot: "Root", thMean: "Meaning", thAns: "Answer"
            },
            fa: {
                title: "ŸÖÿπŸÖÿßÿ± ÿ≤ÿ®ÿßŸÜ ÿ™ÿ±⁄©€å", check: "ÿ®ÿ±ÿ±ÿ≥€å ÿµÿ≠ÿ™", hint: "ÿ™Ÿàÿ∂€åÿ≠ ⁄Øÿ±ÿßŸÖÿ±€å", reveal: "ŸÜŸÖÿß€åÿ¥ Ÿæÿßÿ≥ÿÆ",
                past: "⁄Øÿ∞ÿ¥ÿ™Ÿá ÿ≥ÿßÿØŸá", present: "ÿ≤ŸÖÿßŸÜ ÿ≠ÿßŸÑ", future: "ÿ≤ŸÖÿßŸÜ ÿ¢€åŸÜÿØŸá", continuous: "ÿßÿ≥ÿ™ŸÖÿ±ÿßÿ±€å (-yor)", aorist: "ÿπÿßÿØÿ™€å", perfect: "⁄©ÿßŸÖŸÑ (-mi≈ü)",
                imperative: "ÿ≠ÿßŸÑÿ™ ÿßŸÖÿ±€å", conditional: "ÿ≠ÿßŸÑÿ™ ÿ¥ÿ±ÿ∑€å", obligative: "ÿßŸÑÿ≤ÿßŸÖ", ability: "ÿ™ŸàÿßŸÜÿß€å€å",
                catTense: "ÿ≤ŸÖÿßŸÜ", catAspect: "ÿ¨ŸÜÿ®Ÿá", catMood: "Ÿàÿ¨Ÿá", catHelp: "ÿ¢⁄©ÿßÿØŸÖ€å",
                personNames: {Ben:"ŸÖŸÜ", Sen:"ÿ™Ÿà", O:"ÿßŸà", Biz:"ŸÖÿß", Siz:"ÿ¥ŸÖÿß", Onlar:"ÿß€åÿ¥ÿßŸÜ"}, academy: "üèõÔ∏è ÿ¢⁄©ÿßÿØŸÖ€å", sampleTag: "⁄©ÿßÿ±ÿ®ÿ±ÿØ ÿπŸÖŸÑ€å (ÿµŸàÿ™ ÿ™ÿ±⁄©€å):",
                thRoot: "ÿ±€åÿ¥Ÿá", thMean: "ŸÖÿπŸÜ€å", thAns: "Ÿæÿßÿ≥ÿÆ"
            },
            es: { title: "Arquitecto de Idiomas", check: "Verificar", hint: "Explicaci√≥n Gramatical", reveal: "Respuesta", personNames: {Ben:"Yo", Sen:"T√∫", O:"√âl/Ella", Biz:"Nosotros", Siz:"Ustedes", Onlar:"Ellos"}, academy: "üèõÔ∏è Academia", sampleTag: "USO PR√ÅCTICO:", past: "Pasado Simple", present: "Presente", future: "Futuro", continuous: "Continuo", aorist: "Aoristo", perfect: "Perfecto", imperative: "Imperativo", conditional: "Condicional", obligative: "Obligatorio", ability: "Habilidad" },
            de: { title: "Spracharchitekt", check: "Pr√ºfen", hint: "Grammatik-Erkl√§rung", reveal: "Antwort", personNames: {Ben:"Ich", Sen:"Du", O:"Er/Sie", Biz:"Wir", Siz:"Ihr", Onlar:"Sie"}, academy: "üèõÔ∏è Akademie", sampleTag: "PRAKTISCHE ANWENDUNG:", past: "Vergangenheit", present: "Pr√§sens", future: "Futur", continuous: "Kontinuierlich", aorist: "Aorist", perfect: "Perfekt", imperative: "Imperativ", conditional: "Konditional", obligative: "Obligatorisch", ability: "F√§higkeit" },
            fr: { title: "Architecte de Langue", check: "V√©rifier", hint: "Explication Grammaticale", reveal: "R√©ponse", personNames: {Ben:"Je", Sen:"Tu", O:"Il/Elle", Biz:"Nous", Siz:"Vous", Onlar:"Ils"}, academy: "üèõÔ∏è Acad√©mie", sampleTag: "USAGE PRATIQUE:", past: "Pass√© Simple", present: "Pr√©sent", future: "Futur", continuous: "Continu", aorist: "Aoriste", perfect: "Parfait", imperative: "Imp√©ratif", conditional: "Conditionnel", obligative: "Obligatoire", ability: "Capacit√©" },
            el: { title: "ŒëœÅœáŒπœÑŒ≠Œ∫œÑŒøŒΩŒ±œÇ ŒìŒªœâœÉœÉœéŒΩ", check: "ŒàŒªŒµŒ≥œáŒøœÇ", hint: "ŒìœÅŒ±ŒºŒºŒ±œÑŒπŒ∫ŒÆ ŒïŒæŒÆŒ≥Œ∑œÉŒ∑", reveal: "ŒëœÄŒ¨ŒΩœÑŒ∑œÉŒ∑", personNames: {Ben:"ŒïŒ≥œé", Sen:"ŒïœÉœç", O:"ŒëœÖœÑœåœÇ", Biz:"ŒïŒºŒµŒØœÇ", Siz:"ŒïœÉŒµŒØœÇ", Onlar:"ŒëœÖœÑŒøŒØ"}, academy: "üèõÔ∏è ŒëŒ∫Œ±Œ¥Œ∑ŒºŒØŒ±", sampleTag: "Œ†Œ°ŒëŒöŒ§ŒôŒöŒó ŒßŒ°ŒóŒ£Œó:", past: "ŒëœåœÅŒπœÉœÑŒøœÇ", present: "ŒïŒΩŒµœÉœÑœéœÑŒ±œÇ", future: "ŒúŒ≠ŒªŒªŒøŒΩœÑŒ±œÇ", continuous: "ŒîŒπŒ±œÅŒ∫ŒµŒØŒ±œÇ", aorist: "Œ£œÖŒΩŒÆŒ∏ŒµŒπŒ±", perfect: "Œ†Œ±œÅŒ±Œ∫ŒµŒØŒºŒµŒΩŒøœÇ", imperative: "Œ†œÅŒøœÉœÑŒ±Œ∫œÑŒπŒ∫ŒÆ", conditional: "Œ•œÄŒøŒ∏ŒµœÑŒπŒ∫ŒÆ", obligative: "Œ•œÄŒøœáœÅŒµœâœÑŒπŒ∫ŒÆ", ability: "ŒôŒ∫Œ±ŒΩœåœÑŒ∑œÑŒ±" },
            zh: { title: "ËØ≠Ë®ÄÊû∂ÊûÑÂ∏à", check: "Ê£ÄÊü•", hint: "ËØ≠Ê≥ïËß£Èáä", reveal: "ÊòæÁ§∫Á≠îÊ°à", personNames: {Ben:"Êàë", Sen:"‰Ω†", O:"‰ªñ/Â•π", Biz:"Êàë‰ª¨", Siz:"‰Ω†‰ª¨", Onlar:"‰ªñ‰ª¨"}, academy: "üèõÔ∏è Â≠¶Èô¢", sampleTag: "ÂÆûÈôÖÂ∫îÁî®:", past: "ËøáÂéªÊó∂", present: "Áé∞Âú®Êó∂", future: "Â∞ÜÊù•Êó∂", continuous: "ËøõË°åÊó∂", aorist: "Â∏∏ÊÄÅÊó∂", perfect: "ÂÆåÊàêÊó∂", imperative: "ÂëΩ‰ª§Âºè", conditional: "Êù°‰ª∂Âºè", obligative: "‰πâÂä°Âºè", ability: "ËÉΩÂäõÂºè" },
            ar: { title: "ŸÖŸáŸÜÿØÿ≥ ÿßŸÑŸÑÿ∫ÿ©", check: "ÿ™ÿ≠ŸÇŸÇ", hint: "ÿ¥ÿ±ÿ≠ ŸÇŸàÿßÿπÿØŸä", reveal: "ÿ•ÿ∏Ÿáÿßÿ± ÿßŸÑÿ•ÿ¨ÿßÿ®ÿ©", personNames: {Ben:"ÿ£ŸÜÿß", Sen:"ÿ£ŸÜÿ™", O:"ŸáŸà/ŸáŸä", Biz:"ŸÜÿ≠ŸÜ", Siz:"ÿ£ŸÜÿ™ŸÖ", Onlar:"ŸáŸÖ"}, academy: "üèõÔ∏è ÿßŸÑÿ£ŸÉÿßÿØŸäŸÖŸäÿ©", sampleTag: "ÿßŸÑÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑÿπŸÖŸÑŸä:", past: "ÿßŸÑŸÖÿßÿ∂Ÿä", present: "ÿßŸÑŸÖÿ∂ÿßÿ±ÿπ", future: "ÿßŸÑŸÖÿ≥ÿ™ŸÇÿ®ŸÑ", continuous: "ÿßŸÑŸÖÿ≥ÿ™ŸÖÿ±", aorist: "ÿßŸÑŸàÿßÿ≥ÿπ", perfect: "ÿßŸÑŸÖÿßÿ∂Ÿä ÿßŸÑŸÜŸÇŸÑŸä", imperative: "ÿßŸÑÿ£ŸÖÿ±", conditional: "ÿßŸÑÿ¥ÿ±ÿ∑", obligative: "ÿßŸÑŸàÿ¨Ÿàÿ®", ability: "ÿßŸÑÿßÿ≥ÿ™ÿ∑ÿßÿπÿ©" }
        };

        window.fkSpeak = function(text, lang = 'tr-TR') {
            if (!window.speechSynthesis) return;
            window.speechSynthesis.cancel();
            const msg = new SpeechSynthesisUtterance(text);
            const voices = window.speechSynthesis.getVoices();
            let tLang = lang === 'fa' ? 'fa-IR' : (lang === 'en' ? 'en-US' : (lang === 'zh' ? 'zh-CN' : (lang === 'ar' ? 'ar-SA' : lang)));
            const bestVoice = voices.find(v => v.lang.includes(tLang) && (v.name.includes('Google') || v.name.includes('Natural'))) || voices.find(v => v.lang.includes(tLang));
            if (bestVoice) msg.voice = bestVoice;
            msg.lang = tLang; msg.rate = 0.85;
            window.speechSynthesis.speak(msg);
        };

        window.changeSourceLang = function(val) {
            sourceLang = val;
            document.body.className = (val === 'fa' || val === 'ar') ? 'rtl' : 'ltr';
            updateUI(); build();
        };

        function updateUI() {
            const t = i18n[sourceLang] || i18n['en'];
            document.getElementById('ui-title').innerText = t.title;
            document.getElementById('ui-btn-check').innerText = t.check;
            document.getElementById('ui-btn-hint').innerText = t.hint;
            document.getElementById('ui-btn-reveal').innerText = t.reveal;
            document.getElementById('nav-past').innerText = t.past || "Past";
            document.getElementById('nav-present').innerText = t.present || "Present";
            document.getElementById('nav-future').innerText = t.future || "Future";
            document.getElementById('nav-cont').innerText = t.continuous || "Continuous";
            document.getElementById('nav-aor').innerText = t.aorist || "Aorist";
            document.getElementById('nav-perf').innerText = t.perfect || "Perfect";
            document.getElementById('nav-imp').innerText = t.imperative || "Imperative";
            document.getElementById('nav-cond').innerText = t.conditional || "Conditional";
            document.getElementById('nav-obl').innerText = t.obligative || "Obligative";
            document.getElementById('nav-abil').innerText = t.ability || "Ability";
            document.getElementById('nav-list').innerText = t.list || "Database";
            document.getElementById('nav-academy').innerText = t.academy || "Academy";
            document.getElementById('nav-auth').innerText = t.auth || "Author";
            document.getElementById('ui-sample-tag').innerText = t.sampleTag || "Practical Usage:";
            document.getElementById('cat-tense').innerText = t.catTense || "Tense";
            document.getElementById('cat-aspect').innerText = t.catAspect || "Aspect";
            document.getElementById('cat-mood').innerText = t.catMood || "Mood";
            document.getElementById('cat-help').innerText = t.catHelp || "Academy";
            
            const sidebar = document.getElementById('sidebar');
            const mainArea = document.getElementById('main-area');
            if(sourceLang === 'fa' || sourceLang === 'ar') {
                sidebar.style.right = '0'; sidebar.style.left = 'auto'; sidebar.style.borderRight = 'none'; sidebar.style.borderLeft = '1px solid #1f2937';
                mainArea.style.marginRight = '300px'; mainArea.style.marginLeft = '0';
            } else {
                sidebar.style.left = '0'; sidebar.style.right = 'auto'; sidebar.style.borderLeft = 'none'; sidebar.style.borderRight = '1px solid #1f2937';
                mainArea.style.marginLeft = '300px'; mainArea.style.marginRight = '0';
            }
        }

        window.switchModule = function(mod) {
            currentModule = mod; cur = 0;
            fkTab('quiz'); build();
        };

        // --- Core Turkish Linguistic Engine ---
        function getLogic(v, p, mod) {
            let r = v.toLowerCase();
            let lastV = (r.match(/[aeƒ±io√∂u√º]/g) || ['a']).pop();
            let isVowelEnded = "aeƒ±io√∂u√º".includes(r.slice(-1));
            let isHard = "fstk√ß≈ühp".includes(r.slice(-1));

            const v4 = (v) => "aeƒ±io√∂u√º".includes(v) ? ("aƒ±".includes(v) ? "ƒ±" : "ei".includes(v) ? "i" : "ou".includes(v) ? "u" : "√º") : "i";
            const v2 = (v) => "aeƒ±io√∂u√º".includes(v) ? ("aƒ±ou".includes(v) ? "a" : "e") : "e";
            
            const type1 = {Ben: v4(lastV)+'m', Sen: 'sIn', O: '', Biz: v4(lastV)+'z', Siz: 'sInIz', Onlar: 'lAr'};
            const type2 = {Ben: 'm', Sen: 'n', O: '', Biz: 'k', Siz: 'nIz', Onlar: 'lAr'};
            const type3 = {Ben: '', Sen: '', O: 'sIn', Biz: '', Siz: 'In', Onlar: 'sInlAr'};

            const applyHarmony = (str, lv) => str.replace(/I/g, v4(lv)).replace(/A/g, v2(lv));

            const mutate = (root) => {
                if (root === 'git') return 'gid';
                if (root === 'tat') return 'tad';
                if (root.endsWith('et')) return root.slice(0, -2) + 'ed';
                return root;
            };

            switch(mod) {
                case 'continuous':
                    if (r === 'ye') r = 'yi'; else if (r === 'de') r = 'di';
                    else if (isVowelEnded) r = r.slice(0, -1);
                    return mutate(r) + v4(lastV) + "yor" + applyHarmony(type1[p], 'o');

                case 'past':
                    let d = isHard ? 't' : 'd';
                    return r + d + v4(lastV) + applyHarmony(type2[p], lastV);

                case 'future':
                    let baseF = mutate(r);
                    if (isVowelEnded) baseF += 'y';
                    let suffixF = applyHarmony('AcAk', lastV);
                    if ((p === 'Ben' || p === 'Biz') && suffixF.endsWith('k')) suffixF = suffixF.slice(0, -1) + 'ƒü';
                    return baseF + suffixF + applyHarmony(type1[p], lastV);

                case 'aorist':
                    let aSuffix = isVowelEnded ? 'r' : (v.length <= 3 ? applyHarmony('Ar', lastV) : applyHarmony('Ir', lastV));
                    return mutate(r) + aSuffix + applyHarmony(type1[p], lastV);

                case 'perfect':
                    return r + 'm' + v4(lastV) + '≈ü' + applyHarmony(type1[p], lastV);

                case 'imperative':
                    if (p === 'Ben' || p === 'Biz') return ""; // Filtered out in build()
                    return r + applyHarmony(type3[p], lastV);

                case 'conditional':
                    return r + applyHarmony('sA', lastV) + applyHarmony(type2[p], lastV);

                case 'obligative':
                    return r + applyHarmony('mAlI', lastV) + applyHarmony(type1[p], lastV);
                
                case 'ability':
                    let ab = (isVowelEnded ? 'y' : '') + applyHarmony('Abil', lastV);
                    return mutate(r) + ab + 'ir' + applyHarmony(type1[p], 'i');

                default: return r;
            }
        }

        function generateDetailedHint(v, p, mod, ans) {
            const curI18n = i18n[sourceLang] || i18n['en'];
            const pName = (curI18n.personNames || i18n['en'].personNames)[p] || p;
            const hints = {
                en: `Engineering Analysis: We take the root "${v}". Based on vowel harmony, the "${mod}" operator is applied. For "${pName}", the structure compiles as "${ans}".`,
                fa: `ÿ™ÿ≠ŸÑ€åŸÑ ŸÖŸáŸÜÿØÿ≥€å: ÿ±€åÿ¥Ÿá ¬´${v}¬ª ÿ®ÿß ÿ™Ÿàÿ¨Ÿá ÿ®Ÿá ŸÇŸàÿßŸÜ€åŸÜ ŸáŸÖÿßŸáŸÜ⁄Ø€å ÿßÿµŸàÿßÿ™ Ÿæÿ±ÿØÿßÿ≤ÿ¥ ŸÖ€å‚Äåÿ¥ŸàÿØ. ÿ®ÿ±ÿß€å ÿ∂ŸÖ€åÿ± ¬´${pName}¬ªÿå ÿ≥ÿßÿÆÿ™ÿßÿ± ŸÜŸáÿß€å€å ÿ®Ÿá ÿµŸàÿ±ÿ™ ¬´${ans}¬ª ⁄©ÿßŸÖŸæÿß€åŸÑ ŸÖ€å‚Äå⁄Øÿ±ÿØÿØ.`,
                ar: `ÿßŸÑÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑŸáŸÜÿØÿ≥Ÿä: ŸÜÿ£ÿÆÿ∞ ÿßŸÑÿ¨ÿ∞ÿ± "${v}". ÿ®ŸÜÿßÿ°Ÿã ÿπŸÑŸâ ÿßŸÑÿ™ŸàÿßŸÅŸÇ ÿßŸÑÿµŸàÿ™Ÿäÿå Ÿäÿ™ŸÖ ÿ™ÿ∑ÿ®ŸäŸÇ ÿπÿßŸÖŸÑ "${mod}". ÿ®ÿßŸÑŸÜÿ≥ÿ®ÿ© ŸÑŸÑÿ∂ŸÖŸäÿ± "${pName}"ÿå Ÿäÿ™ŸÖ ÿ™ÿ¨ŸÖŸäÿπ ÿßŸÑÿµŸäÿ∫ÿ© ŸÑÿ™ÿµÿ®ÿ≠ "${ans}".`,
                es: `An√°lisis de ingenier√≠a: Tomamos la ra√≠z "${v}". Seg√∫n la armon√≠a voc√°lica, se aplica el operador "${mod}". Para "${pName}", la estructura se compila como "${ans}".`,
                de: `Engineering-Analyse: Wir nehmen den Stamm "${v}". Basierend auf der Vokalharmonie wird der Operator "${mod}" angewendet. F√ºr "${pName}" wird die Struktur als "${ans}" kompiliert.`,
                fr: `Analyse d'ing√©nierie : Nous prenons la racine "${v}". Bas√© sur l'harmonie vocalique, l'op√©rateur "${mod}" est appliqu√©. Pour "${pName}", la structure est compil√©e en "${ans}".`,
                el: `ŒëŒΩŒ¨ŒªœÖœÉŒ∑ ŒúŒ∑œáŒ±ŒΩŒπŒ∫ŒÆœÇ: Œ†Œ±ŒØœÅŒΩŒøœÖŒºŒµ œÑŒ∑ œÅŒØŒ∂Œ± "${v}". ŒúŒµ Œ≤Œ¨œÉŒ∑ œÑŒ∑ œÜœâŒΩŒ∑œÑŒπŒ∫ŒÆ Œ±œÅŒºŒøŒΩŒØŒ±, ŒµœÜŒ±œÅŒºœåŒ∂ŒµœÑŒ±Œπ Œø œÑŒµŒªŒµœÉœÑŒÆœÇ "${mod}". ŒìŒπŒ± œÑŒø œÄœÅœåœÉœâœÄŒø "${pName}", Œ∑ Œ¥ŒøŒºŒÆ ŒºŒµœÑŒ±Œ≥ŒªœâœÑœÑŒØŒ∂ŒµœÑŒ±Œπ œâœÇ "${ans}".`,
                zh: `Â∑•Á®ãÂàÜÊûêÔºöÊàë‰ª¨ÊèêÂèñËØçÊ†π "${v}"„ÄÇÊ†πÊçÆÂÖÉÈü≥ÂíåË∞êËßÑÂàôÂ∫îÁî® "${mod}" ÁÆóÂ≠ê„ÄÇÂØπ‰∫é "${pName}"ÔºåÊúÄÁªàÁªìÊûÑÁºñËØë‰∏∫ "${ans}"„ÄÇ`
            };
            return hints[sourceLang] || hints['en'];
        }

        const verbContexts = {
            'Gel': { en: "to come", fa: "ÿ¢ŸÖÿØŸÜ", scen: { tr: "Annem ak≈üam yemeƒüi i√ßin eve geliyor. Hepimiz heyecanla sofrada bekliyoruz. O her zaman harika yemekler hazƒ±rlar.", en: "My mother is coming home for dinner. We are all waiting excitedly at the table. She always prepares wonderful meals.", fa: "ŸÖÿßÿØÿ±ŸÖ ÿ®ÿ±ÿß€å ÿ¥ÿßŸÖ ÿ®Ÿá ÿÆÿßŸÜŸá ŸÖ€å‚Äåÿ¢€åÿØ. ŸáŸÖŸá ŸÖÿß ÿ®ÿß Ÿá€åÿ¨ÿßŸÜ ÿ≥ÿ± ÿ≥ŸÅÿ±Ÿá ŸÖŸÜÿ™ÿ∏ÿ± Ÿáÿ≥ÿ™€åŸÖ. ÿßŸà ŸáŸÖ€åÿ¥Ÿá ÿ∫ÿ∞ÿßŸáÿß€å ŸÅŸàŸÇ‚ÄåÿßŸÑÿπÿßÿØŸá‚Äåÿß€å ÿ¢ŸÖÿßÿØŸá ŸÖ€å‚Äå⁄©ŸÜÿØ." }},
            'Git': { en: "to go", fa: "ÿ±ŸÅÿ™ŸÜ", scen: { tr: "Babam her sabah erkenden i≈üe gidiyor. O √ßok √ßalƒ±≈ükan bir adamdƒ±r. Ailesi i√ßin her g√ºn √ßok yorulur.", en: "My father goes to work early every morning. He is a very hard-working man. He gets very tired for his family every day.", fa: "ŸæÿØÿ±ŸÖ Ÿáÿ± ÿ±Ÿàÿ≤ ÿµÿ®ÿ≠ ÿ≤ŸàÿØ ÿ®Ÿá ÿ≥ÿ± ⁄©ÿßÿ± ŸÖ€å‚Äåÿ±ŸàÿØ. ÿßŸà ŸÖÿ±ÿØ ÿ®ÿ≥€åÿßÿ± ⁄©Ÿàÿ¥ÿß€å€å ÿßÿ≥ÿ™. ÿßŸà Ÿáÿ± ÿ±Ÿàÿ≤ ÿ®ÿ±ÿß€å ÿÆÿßŸÜŸàÿßÿØŸá‚Äåÿßÿ¥ ÿÆ€åŸÑ€å ÿÆÿ≥ÿ™Ÿá ŸÖ€å‚Äåÿ¥ŸàÿØ." }},
            'Bak': { en: "to look", fa: "ŸÜ⁄ØÿßŸá ⁄©ÿ±ÿØŸÜ", scen: { tr: "Pencereden dƒ±≈üarƒ±ya dikkatle bakƒ±yorum. Kar yaƒüƒ±yor ve her yer bembeyaz. Doƒüa bug√ºn harika g√∂r√ºn√ºyor.", en: "I am looking out the window carefully. It's snowing and everywhere is pitch white. Nature looks wonderful today.", fa: "ÿ®ÿß ÿØŸÇÿ™ ÿßÿ≤ ŸæŸÜÿ¨ÿ±Ÿá ÿ®Ÿá ÿ®€åÿ±ŸàŸÜ ŸÜ⁄ØÿßŸá ŸÖ€å‚Äå⁄©ŸÜŸÖ. ÿ®ÿ±ŸÅ ŸÖ€å‚Äåÿ®ÿßÿ±ÿØ Ÿà ŸáŸÖŸá‚Äåÿ¨ÿß ⁄©ÿßŸÖŸÑÿßŸã ÿ≥ŸÅ€åÿØ ÿßÿ≥ÿ™. ÿ∑ÿ®€åÿπÿ™ ÿßŸÖÿ±Ÿàÿ≤ ŸÅŸàŸÇ‚ÄåÿßŸÑÿπÿßÿØŸá ÿ®Ÿá ŸÜÿ∏ÿ± ŸÖ€å‚Äåÿ±ÿ≥ÿØ." }},
            'Oku': { en: "to read", fa: "ÿÆŸàÿßŸÜÿØŸÜ", scen: { tr: "K√ºt√ºphanede sessizce kitap okuyorum. Bu hikaye beni √ßok etkiledi. Ak≈üam bitirmeyi planlƒ±yorum.", en: "I am reading a book quietly in the library. This story moved me a lot. I plan to finish it tonight.", fa: "ÿØÿ± ⁄©ÿ™ÿßÿ®ÿÆÿßŸÜŸá ÿ®ÿß ÿ¢ÿ±ÿßŸÖÿ¥ ⁄©ÿ™ÿßÿ® ŸÖ€å‚ÄåÿÆŸàÿßŸÜŸÖ. ÿß€åŸÜ ÿØÿßÿ≥ÿ™ÿßŸÜ ÿÆ€åŸÑ€å ŸÖÿ±ÿß ÿ™ÿ≠ÿ™ ÿ™ÿßÿ´€åÿ± ŸÇÿ±ÿßÿ± ÿØÿßÿØ. ŸÇÿµÿØ ÿØÿßÿ±ŸÖ ÿßŸÖÿ¥ÿ® ÿ™ŸÖÿßŸÖÿ¥ ⁄©ŸÜŸÖ." }},
            'Yaz': { en: "to write", fa: "ŸÜŸàÿ¥ÿ™ŸÜ", scen: { tr: "G√ºnl√ºƒü√ºme bug√ºnk√º anƒ±larƒ±mƒ± yazƒ±yorum. √áok maceralƒ± bir g√ºnd√º. Gelecekte bunlarƒ± tekrar okuyacaƒüƒ±m.", en: "I am writing today's memories in my diary. It was a very adventurous day. I will read these again in the future.", fa: "ÿÆÿßÿ∑ÿ±ÿßÿ™ ÿßŸÖÿ±Ÿàÿ≤ ÿ±ÿß ÿØÿ± ÿØŸÅÿ™ÿ±⁄ÜŸá ÿÆÿßÿ∑ÿ±ÿßÿ™ŸÖ ŸÖ€å‚ÄåŸÜŸà€åÿ≥ŸÖ. ÿ±Ÿàÿ≤ ÿ®ÿ≥€åÿßÿ± Ÿæÿ±ŸÖÿßÿ¨ÿ±ÿß€å€å ÿ®ŸàÿØ. ÿØÿ± ÿ¢€åŸÜÿØŸá ÿØŸàÿ®ÿßÿ±Ÿá ÿß€åŸÜ‚ÄåŸáÿß ÿ±ÿß ÿÆŸàÿßŸáŸÖ ÿÆŸàÿßŸÜÿØ." }}
        };

        function build() {
            items = [];
            const basePool = ['Gel','Bak','Git','Oku','Yaz','G√∂r','Sev','Yap','ƒ∞√ß','Sor','Al','Bul','Ver','Uyu','Koÿ¥','G√ºl','Dur','Kapat','A√ß','Dinle','Bil','Bitir','√áalƒ±≈ü','Kal','S√ºr','Y√ºz','Bin','ƒ∞n','U√ß','Ta≈üƒ±','D√º≈ü√ºn','Tanƒ±','√ñzle','Sus','Otur','Kalk','Yat','Yƒ±k','Dene','Se√ß','Topla','Ara','G√∂nder','Getir','G√∂t√ºr','Kazan','Kaybet','Vur','Tut','Bƒ±rak','Kƒ±r','Pi≈üir','Tad','Kokla','Dokun','Ka√ß','Sakla','Gez','Kƒ±z','Konu≈ü','G√ºl√ºmse','Hazƒ±rla','Unut','Hatƒ±rla','Deƒüi≈ütir','Y√ºr√º','Dinlen','Fƒ±r√ßala','Oyna','Baƒüƒ±r','Tƒ±rman','Boya','Hƒ±zlan','Yava≈üla','Koru','Hisset','Teÿ¥ekk√ºr et','Kahvaltƒ± yap','Spor yap'];
            const personKeys = ['Ben','Sen','O','Biz','Siz','Onlar'];
            const impPersons = ['Sen','O','Siz','Onlar'];

            for(let i=0; i<100; i++) {
                let r = basePool[i % basePool.length];
                let pKey = (currentModule === 'imperative') ? impPersons[i % 4] : personKeys[i % 6];
                let ans = getLogic(r, pKey, currentModule);
                
                let info = verbContexts[r] || {scen: {tr: `${r} eylemi hakkƒ±nda bir hikaye. Her ≈üey yolunda gidecek.`, en: `A story about the action of ${r}. Everything will be fine.`, fa: `ÿØÿßÿ≥ÿ™ÿßŸÜ€å ÿØÿ±ÿ®ÿßÿ±Ÿá ÿπŸÖŸÑ ${r}. ŸáŸÖŸá ⁄Ü€åÿ≤ ÿÆŸàÿ® Ÿæ€åÿ¥ ÿÆŸàÿßŸáÿØ ÿ±ŸÅÿ™.`}};
                
                items.push({
                    r: r, m: (info[sourceLang] || r) + " (Verb)", p: pKey, ans: ans, 
                    hint: generateDetailedHint(r, pKey, currentModule, ans),
                    sample: info.scen.tr, sampleT: info.scen[sourceLang] || info.scen.en
                });
            }
            load();
        }

        window.fkTab = function(t) {
            ['academy', 'quiz', 'list', 'auth'].forEach(s => { const el = document.getElementById('sec-'+s); if(el) el.style.display = 'none'; });
            document.getElementById('sec-'+t).style.display = 'block';
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            if(t === 'list') renderList();
            if(t === 'academy') {
                const tInfo = i18n[sourceLang] || i18n['en'];
                document.getElementById('academy-body').innerHTML = `<h2>${tInfo.academy}</h2><p>Engineering Turkish: A Lego Architecture</p><p>Explore the rules of vowel harmony and agglutination in this module.</p>`;
            }
        };

        window.move = function(d) { cur=(cur+d+100)%100; load(); };
        
        function load() {
            const q = items[cur];
            const t = i18n[sourceLang] || i18n['en'];
            const pNames = t.personNames || i18n['en'].personNames;
            const pn = pNames[q.p] || q.p;

            document.getElementById('module-title-ui').innerText = t[currentModule] || currentModule;
            document.getElementById('v-root').innerText = q.r.toUpperCase();
            document.getElementById('v-mean').innerText = `(${q.m})`;
            document.getElementById('v-pers').innerText = `${q.p.toUpperCase()} (${pn})`;
            document.getElementById('fk-info').innerText = `${t.step || "Step"} ${cur+1} / 100`;
            document.getElementById('fk-input').value = ""; document.getElementById('fk-input').className = "";
            document.getElementById('v-expl').style.display = 'none';
            document.getElementById('sample-tr').innerText = q.sample;
            document.getElementById('sample-target').innerText = q.sampleT;
            
            document.getElementById('sample-tr').onclick = () => fkSpeak(q.sample, 'tr-TR');
            document.getElementById('v-root').onclick = () => fkSpeak(q.r, 'tr-TR');
        }

        window.toggleHint = function() {
            const e = document.getElementById('v-expl'); const q = items[cur];
            e.innerText = q.hint;
            const isVisible = e.style.display === 'block';
            e.style.display = isVisible ? 'none' : 'block';
            if (!isVisible && sourceLang !== 'fa' && sourceLang !== 'ar') fkSpeak(q.hint, sourceLang);
        };

        window.check = function() {
            if(document.getElementById('fk-input').value.trim().toLowerCase() === items[cur].ans.toLowerCase()) {
                score+=10; document.getElementById('fk-score').innerText = `${(i18n[sourceLang]||i18n['en']).score}: ${score}`;
                document.getElementById('fk-input').className = "correct";
                fkSpeak(items[cur].ans, 'tr-TR');
            } else document.getElementById('fk-input').className = "wrong";
        };

        window.reveal = function() {
            document.getElementById('fk-input').value = items[cur].ans;
            fkSpeak(items[cur].ans, 'tr-TR');
        };

        function renderList() {
            const b = document.getElementById('list-body'); b.innerHTML = "";
            items.forEach((q, i) => {
                b.innerHTML += `<tr><td>${i+1}</td><td style="color:var(--accent-root);font-weight:bold">${q.r}</td><td>${q.m}</td><td dir="ltr">${q.ans}</td><td><button onclick="fkSpeak('${q.ans}')">üîä</button></td></tr>`;
            });
        }

        window.speechSynthesis.onvoiceschanged = () => window.speechSynthesis.getVoices();
        changeSourceLang('en');
        switchModule('past');
    })();
    </script>
</body>
</html>
